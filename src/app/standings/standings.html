<mat-toolbar color="primary" class="mat-elevation-z4">
  <span class="toolbar-title">
    <mat-icon>sports_soccer</mat-icon> Football Standings
  </span>
</mat-toolbar>

<div class="standings-container">
  <mat-card class="filter-card mat-elevation-z4">
    <mat-card-header>
      <mat-card-title>Filter Standings</mat-card-title>
      <mat-card-subtitle>Select options to view specific league and team standings</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form>
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Country</mat-label>
            <mat-select [(ngModel)]="country" name="country" (selectionChange)="onCountryChange()">
              <mat-option *ngFor="let c of countries" [value]="c.country_id">
                <img *ngIf="c.country_logo" [src]="c.country_logo" width="20" style="vertical-align:middle; margin-right:8px;">
                {{c.country_name}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>League</mat-label>
            <mat-select [(ngModel)]="league" name="league" (selectionChange)="onLeagueChange()">
              <mat-option *ngFor="let l of leagues" [value]="l.league_id">
                <img *ngIf="l.league_logo" [src]="l.league_logo" width="20" style="vertical-align:middle; margin-right:8px;">
                {{l.league_name}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Team</mat-label>
            <mat-select [(ngModel)]="team" name="team">
              <mat-option *ngFor="let t of teams" [value]="t.team_key">
                <img *ngIf="t.team_badge" [src]="t.team_badge" width="20" style="vertical-align:middle; margin-right:8px;">
                {{t.team_name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <mat-slide-toggle [(ngModel)]="offlineMode" name="offlineMode" (change)="loadCountries()">
            Offline Mode
          </mat-slide-toggle>

          <button mat-raised-button color="primary" type="button" (click)="getStandings(team)">
            <mat-icon>search</mat-icon> Get Standings
          </button>

          <button mat-raised-button color="accent" type="button" (click)="getStandings()">
            <mat-icon>list</mat-icon> Show All Positions
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="results-card mat-elevation-z4" *ngIf="standings">
    <mat-card-header>
      <mat-card-title>Standings</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="standings.length">
        <table mat-table [dataSource]="standings" class="mat-elevation-z2 standings-table">

          <ng-container matColumnDef="position">
            <th mat-header-cell *matHeaderCellDef> Position </th>
            <td mat-cell *matCellDef="let s"> {{s.overall_league_position || s.position}} </td>
          </ng-container>

          <ng-container matColumnDef="team">
            <th mat-header-cell *matHeaderCellDef> Team </th>
            <td mat-cell *matCellDef="let s">
              <img *ngIf="s.team_badge" [src]="s.team_badge" width="20" style="vertical-align:middle; margin-right:8px;">
              {{s.team_name || s.team}}
            </td>
          </ng-container>

          <ng-container matColumnDef="points">
            <th mat-header-cell *matHeaderCellDef> Points </th>
            <td mat-cell *matCellDef="let s"> {{s.overall_league_PTS || s.points}} </td>
          </ng-container>

          <ng-container matColumnDef="played">
            <th mat-header-cell *matHeaderCellDef> Played </th>
            <td mat-cell *matCellDef="let s"> {{s.overall_league_payed || s.played}} </td>
          </ng-container>

          <ng-container matColumnDef="won">
            <th mat-header-cell *matHeaderCellDef> Won </th>
            <td mat-cell *matCellDef="let s"> {{s.overall_league_W || s.won}} </td>
          </ng-container>

          <ng-container matColumnDef="drawn">
            <th mat-header-cell *matHeaderCellDef> Drawn </th>
            <td mat-cell *matCellDef="let s"> {{s.overall_league_D || s.drawn}} </td>
          </ng-container>

          <ng-container matColumnDef="lost">
            <th mat-header-cell *matHeaderCellDef> Lost </th>
            <td mat-cell *matCellDef="let s"> {{s.overall_league_L || s.lost}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['position','team','points','played','won','drawn','lost']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['position','team','points','played','won','drawn','lost'];"></tr>
        </table>
      </div>

      <div *ngIf="offlineMode && (!standings || !standings.length)" class="no-data">
        <mat-icon color="warn">info</mat-icon> No cached data available for offline mode.
      </div>
    </mat-card-content>
  </mat-card>
</div>
